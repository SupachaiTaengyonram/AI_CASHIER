<!DOCTYPE html>
<html>
<head>
    <title>‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
          rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">
    <div class="card shadow" style="max-width: 900px; margin: auto;">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (Payment)</h4>
        </div>
        <div class="card-body">

            <!-- Summary -->
            <div class="alert alert-info text-center">
                <h5>‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h5>
                <h2 class="fw-bold">{{ amount_text }} ‡∏ö‡∏≤‡∏ó</h2>
                <small>Ref: {{ reference }}</small>
            </div>

            <div class="row">
                <!-- Stripe Payment Link with QR Code -->
                <div class="col-md-8 mx-auto text-center mb-4">
                    {% if qr_code_url %}
                        <h5 class="mb-4 text-primary">üì± ‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h5>
                        
                        <div class="p-4 border rounded bg-white d-inline-block">
                            <img src="{{ qr_code_url }}" class="img-fluid" style="max-width: 300px; max-height: 300px;">
                        </div>
                        
                        <p class="mt-4 text-muted">‡∏´‡∏£‡∏∑‡∏≠</p>
                        
                        <a href="{{ payment_url }}" target="_blank" class="btn btn-primary btn-lg mt-3">
                            üîó ‡πÄ‡∏õ‡∏¥‡∏î Payment Page
                        </a>
                        
                        <p class="mt-4 text-success fw-bold">
                            <small>‡∏™‡πÅ‡∏Å‡∏ô QR code ‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</small>
                        </p>
                        
                        <div class="alert alert-info mt-4 small">
                            <strong>üìù ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô:</strong><br>
                            1. ‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡∏î‡πâ‡∏ß‡∏¢‡πÅ‡∏≠‡∏õ PromptPay ‡∏´‡∏£‡∏∑‡∏≠‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì<br>
                            2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô: {{ amount_text }} ‡∏ö‡∏≤‡∏ó<br>
                            3. ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô<br>
                            4. ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                        </div>
                        
                    {% else %}
                        <div class="alert alert-danger">
                            <strong>‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á Payment Link ‡πÑ‡∏î‡πâ</strong><br>
                            <small class="text-muted">{{ payment_error_msg }}</small>
                        </div>
                        <div class="alert alert-warning small">
                            <strong>üîß ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:</strong><br>
                            1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö STRIPE_SECRET_KEY ‡πÉ‡∏ô .env<br>
                            2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï Stripe account<br>
                            3. ‡πÄ‡∏õ‡∏¥‡∏î Stripe Dashboard ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á Payment Link ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á
                        </div>
                    {% endif %}
                </div>

            </div>

        </div>
    </div>
</div>

<script src="https://js.stripe.com/v3/"></script>
<script>

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô
    (function () {
        var paymentUrl = "{{ payment_url|escapejs }}";
        if (paymentUrl) {
            // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Payment Link ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏û‡∏£‡∏≤‡∏∞ Stripe ‡∏à‡∏∞ redirect ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
            // ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏≤‡∏Å webhook ‡∏Å‡πá‡πÉ‡∏ä‡πâ API ‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ
            setInterval(function () {
                fetch("{% url 'stripe_payment_status' payment.id %}")
                    .then(response => response.json())
                    .then(data => {
                        if (data.paid === true || data.status === 'succeeded') {
                            window.location.href = "{% url 'payment_success' payment.id %}";
                        }
                    })
                    .catch(error => console.log('Status check...', error));
            }, 5000); // Check every 5 seconds
        }
    })();
</script>

</body>
</html>
