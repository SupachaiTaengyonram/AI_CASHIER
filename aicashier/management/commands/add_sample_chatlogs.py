from django.core.management.base import BaseCommand
from django.utils import timezone
from datetime import timedelta
from aicashier.models import ChatLog, Customer
import random

class Command(BaseCommand):
    help = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ä‡∏ó‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö Top User Queries'

    def handle(self, *args, **options):
        # ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏ö‡πà‡∏≠‡∏¢
        queries = [
            '‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏´‡∏ô‡∏Ñ‡∏∏‡πâ‡∏°‡∏™‡∏∏‡∏î',
            '‡∏°‡∏µ‡∏£‡∏™‡∏ä‡∏≤‡∏ï‡∏¥‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á',
            '‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà',
            '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏∞‡πÑ‡∏£',
            '‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà',
            '‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô‡πÑ‡∏î‡πâ‡∏ö‡πâ‡∏≤‡∏á',
            '‡∏Ç‡∏≠‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏´‡∏°',
            '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏±‡∏ß‡πÑ‡∏´‡∏ô‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ',
            '‡∏°‡∏µ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡πÑ‡∏´‡∏°',
            '‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà',
        ]
        
        responses = [
            '‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°! ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡πâ‡∏°‡∏™‡∏∏‡∏î‡∏Ñ‡∏∑‡∏≠‡∏Ç‡∏ô‡∏≤‡∏î L',
            '‡∏°‡∏µ‡∏£‡∏™‡∏ä‡∏≤‡∏ï‡∏¥‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡πÄ‡∏ä‡πà‡∏ô ‡πÇ‡∏≠‡πÄ‡∏ß‡∏ô‡πÑ‡∏ó‡∏¢ ‡∏£‡∏™‡∏ä‡∏≤‡∏ï‡∏¥‡∏î‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏¥‡∏°',
            '‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà 50 ‡∏ö‡∏≤‡∏ó ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ ‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î',
            '‡πÄ‡∏£‡∏≤‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏°‡∏ô‡∏π‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ï‡πà‡∏≤‡∏á‡πÜ',
            '‡πÄ‡∏£‡∏≤‡∏°‡∏µ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î 10% ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ã‡∏∑‡πâ‡∏≠ 2 ‡πÅ‡∏Å‡πâ‡∏ß',
            '‡πÄ‡∏£‡∏≤‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡∏ú‡πà‡∏≤‡∏ô PromptPay, ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î, ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï',
            '‡∏Ç‡∏≠‡∏á‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏û‡∏≠ ‡∏£‡∏£‡∏û‡πÄ‡∏´‡∏•‡∏∑‡∏≠',
            '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏°‡∏ô‡∏π‡∏£‡∏ß‡∏° ‡πÄ‡∏£‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏•‡∏≠‡∏á‡∏ã‡∏¥‡∏Ñ‡∏£‡∏±‡∏ö',
            '‡πÉ‡∏ä‡πà‡∏Ñ‡∏£‡∏±‡∏ö ‡πÄ‡∏£‡∏≤‡∏°‡∏µ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ',
            '‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡∏ß 80 ‡∏ö‡∏≤‡∏ó ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏≤‡∏°‡πÅ‡∏Å‡πâ‡∏ß 150 ‡∏ö‡∏≤‡∏ó',
        ]
        
        # ‡∏î‡∏∂‡∏á customer ‡∏ï‡∏±‡∏ß‡πÅ‡∏£‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
        customer = Customer.objects.first()
        
        # ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ä‡∏ó 30 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
        chat_logs = []
        thirty_days_ago = timezone.now() - timedelta(days=30)
        
        for i in range(30):
            # ‡∏™‡∏∏‡πà‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á 30 ‡∏ß‡∏±‡∏ô
            random_day = random.randint(0, 29)
            created_at = thirty_days_ago + timedelta(days=random_day, hours=random.randint(0, 23), minutes=random.randint(0, 59))
            
            # ‡∏™‡∏∏‡πà‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏ö‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏à‡∏∞‡∏ã‡πâ‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà)
            query = random.choice(queries)
            response = responses[queries.index(query)]
            
            chat_logs.append(
                ChatLog(
                    customer=customer,
                    user_query=query,
                    ai_response=response,
                    created_at=created_at
                )
            )
        
        # ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        ChatLog.objects.bulk_create(chat_logs)
        
        self.stdout.write(
            self.style.SUCCESS(f'‚úì ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ä‡∏ó 30 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢')
        )
        self.stdout.write(
            self.style.WARNING(f'üí° ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏ô‡πâ‡∏≤ overviews ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡πÅ‡∏ä‡∏ó‡πÅ‡∏•‡πâ‡∏ß')
        )
